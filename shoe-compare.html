<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Shoe</title>
  <link rel="icon" href="resources/logo.png">
  
  <!-- Stylesheets -->
  <!-- TODO remove unused css rules-->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

</head>

<body>

<!-- Start Header -->
<header id="header">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="logo">
          <a href="#"><img src="resources/logo.png" alt="logo" class="img-responsive"></a>
          <span class="company-name"><p>Shoe</p></span>
        </div>
        <div class="navigation">
          <nav>
            <ul class="custom-list list-inline">
              <li><a href="#">Home</a></li>
              <li><a href="#events">Blog</a></li>
              <li><a href="#faq">Contact Us</a></li>
              <li><a href="#hero" class="btn btn-red">Sign Up</a></li>
            </ul>
          </nav>
          <i class="fa fa-list toggleMenu"></i>
        </div>
      </div>
    </div>
  </div>
</header>
<!-- End Header -->


<div id="compare-panel">
    <div class="col-xs-12 squish-header">
        <h2>Face Off</h2>
    </div>
    <div class="col-xs-5 col-xs-offset-1 squish-header">
            <img src="" alt="" class=" shoe-image" id="shoe-image-1">
            <h5><span id="shoe-name-1"></span></h5>
    </div>
    
    <div class="col-xs-5 squish-header">
        <img src="" alt="" class=" shoe-image" id="shoe-image-2">
        <h5><span id="shoe-name-2"></span></h5>
    </div>
    
    <div class="col-xs-12" id="barchart">
    </div>

</div>


<!-- Scripts -->
<script src="js/jquery-2.1.4.min.js"></script>
<script src="js/scripts.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.easing.min.js"></script>
<script src="js/jquery.ba-outside-events.min.js"></script>
<script src="js/jquery.ui.min.js"></script>
<script src='http://d3js.org/d3.v3.min.js'></script>
<script src="js/barchart.js"></script>

<script type="text/javascript">
    //converts the data from database request to be D3 friendly
    function convertObj(shoeObj){
        var categories = ["traction", "cushion", "materials", "fit", "support"];
        var shoe=[];
        for(var key in shoeObj){
            if(categories.indexOf(key)>=0){
                shoe.push({name:key, value: shoeObj[key]});
            }
        }
        return shoe;
    }
    
    //parses the query string from url
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
    
    /**  Prepares shoe information for visual comparison **/
    //$(document).ready(function() {
        //we get the names of the shoes to compare from query string
        var name_1 = getParameterByName('name-1');
        var name_2 = getParameterByName('name-2');
        
        $.ajax({
            type:"GET",
            data:{'name_1': name_1, 'name_2': name_2},
            url:"database/get-shoes-compare.php",
            dataType:"json",
            success: function(response){   
                //we update the images and text
                $("#shoe-image-1").attr("src","resources/thumbnails/thumb-" + response[0].image);
                $("#shoe-image-2").attr("src","resources/thumbnails/thumb-" + response[1].image);
                $("#shoe-name-1").text(name_1);
                $("#shoe-name-2").text(name_2);

                //we draw the bar chart comparing the shoes
                draw(convertObj(response[0]), convertObj(response[1]));
            }
        });
    //});
</script>


</body>
</html>
