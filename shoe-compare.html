<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Shoe</title>
  <link rel="icon" href="resources/thumbnails/logo.png">
  
  <!-- Stylesheets -->
  <!-- TODO remove unused css rules-->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.3.1/css/swiper.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

  <style>
    .swiper-container {
        width: 100px;
        height: 100px;
    }    
  </style>

</head>

<body>

<!-- Start Header -->
<header id="header">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="logo">
          <a href="#"><img src="resources/thumbnails/logo.png" alt="logo" class="img-responsive"></a>
          <span class="company-name"><p>Shoe</p></span>
        </div>
        <div class="navigation">
          <nav>
            <ul class="custom-list list-inline">
              <li><a href="#">Home</a></li>
              <li><a href="#events">Blog</a></li>
              <li><a href="#faq">Contact Us</a></li>
              <li><a href="#hero" class="btn btn-red">Sign Up</a></li>
            </ul>
          </nav>
          <i class="fa fa-list toggleMenu"></i>
        </div>
      </div>
    </div>
  </div>
</header>
<!-- End Header -->


<div id="compare-panel">
    <div class="col-xs-10 col-xs-offset-2 squish-header">
        <h2>Face Off</h2>
    </div>
    <div class="col-xs-5 col-xs-offset-2 squish-header">
            <img src="" alt="" class=" shoe-image" id="shoe-image-1">
            <h5><span id="shoe-name-1"></span></h5>
    </div>
    
    <div class="col-xs-5 squish-header">
        <img src="" alt="" class=" shoe-image" id="shoe-image-2">
        <h5><span id="shoe-name-2"></span></h5>
    </div>
    
    <div class="col-xs-12" id="barchart">
    </div>
    <!-- TODO LIST -->
    <!-- Priority: Low | link tech to separate description page -->
    <!-- Priority: High | Include scrollable list of reviews Good/Bad -scrape from Amazon? -->
    <!-- Priority: High | Include additional videos/pictures of shoe -->
    <!-- Priority: Medium | Include discussion section for users to talk about shoes -->
    
    <div class= "col-xs-12" id="compare-table">
        <table class="table">
            <tr id="shoe-price" >
                <td class="col-xs-2">Price</td>
                <td class="col-xs-5"></td>
                <td class="col-xs-5"></td>
            </tr>
            <tr id="shoe-blurb" >
                <td class="col-xs-2">Detail</td>
                <td class="col-xs-5"></td>
                <td class="col-xs-5"></td>
            </tr>
            <tr id="shoe-tech" >
                <td class="col-xs-2">Tech</td>
                <td class="col-xs-5"></td>
                <td class="col-xs-5"></td>
            </tr>
            <tr id="shoe-extra-images">
                <td class="col-xs-2">Gallery</td>
                <td class="col-xs-5"><div class="swiper-container" id="extra-images-1"></div></td>
                <td class="col-xs-5"><div class="swiper-container" id="extra-images-2"></div></td>
            </tr>
            
        </table>
    </div>
</div>


<!-- Scripts -->
<script src="js/jquery-1.12.3.min.js"></script>
<script src='http://d3js.org/d3.v3.min.js'></script>
<script src="js/barchart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.3.1/js/swiper.jquery.min.js"></script>

<script type="text/javascript">
    //converts the data from database request to be D3 friendly
    function convertObj(shoeObj){
        var categories = ["traction", "cushion", "materials", "fit", "support"];
        var shoe=[];
        for(var key in shoeObj){
            if(categories.indexOf(key)>=0){
                shoe.push({name:key, value: shoeObj[key]});
            }
        }
        return shoe;
    }
    
    //parses the query string from url
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
    
    
    /**  Prepares shoe information for visual comparison **/
    var name_1 = getParameterByName('name-1');
    var name_2 = getParameterByName('name-2');
        
    $.ajax({
        type:"GET",
        data:{'name_1': name_1, 'name_2': name_2},
        url:"database/get-shoes-compare.php",
        dataType:"json",
        success: function(response){   
        
            //we update the images and text
            $("#shoe-image-1").attr("src","resources/thumbnails/thumb-" + response[0].image);
            $("#shoe-image-2").attr("src","resources/thumbnails/thumb-" + response[1].image);
            $("#shoe-name-1").text(name_1);
            $("#shoe-name-2").text(name_2);

            //update the table with comparison information
            $("#shoe-price td:nth-child(2)").html("$"+response[0].price);
            $("#shoe-price td:nth-child(3)").html("$"+response[1].price); 
            $("#shoe-blurb td:nth-child(2)").html(response[0].blurb);
            $("#shoe-blurb td:nth-child(3)").html(response[1].blurb);
            
            //generate the list of shoe tech for comparison
            var tech_1 = response[0].tech.split(",");
            var tech_2 = response[1].tech.split(",");
            var tech_1_list = "";
            var tech_2_list = "";
            for(var i=0; i < tech_1.length; i++){
                tech_1_list = tech_1_list + "<li>" + tech_1[i] + "</li>";
            }
            for(var j=0; j < tech_2.length; j++){
                tech_2_list = tech_2_list + "<li>" + tech_2[j] + "</li>";
            }
            tech_1_list = "<ul>" + tech_1_list + "</ul>";
            tech_2_list = "<ul>" + tech_2_list + "</ul>";
            $("#shoe-tech td:nth-child(2)").html(tech_1_list);
            $("#shoe-tech td:nth-child(3)").html(tech_2_list);
            
            var extra_i = +response[0].extra;
            var extra_j = +response[1].extra;
            var img_1_root = response[0].image.slice(0,-4);
            var img_2_root = response[1].image.slice(0,-4);
            
            //setup image gallery
            
            
            var temp_img_html = '<div class="swiper-wrapper">';
            for(var i=2; i<= extra_i; i++){
                temp_img_html += '<div class="swiper-slide"><img class="shoe-image" src="resources/extra/' + img_1_root + '-' + i + '.jpg"></div>';
            }
            temp_img_html += '</div>';
            
            console.log(temp_img_html);
            $("#extra-images-1").html(temp_img_html);
               
            temp_img_html = '<div class="swiper-wrapper">';  
            for(var j=2; j<= extra_j; j++){
                temp_img_html += '<div class="swiper-slide"><img class="shoe-image" src="resources/extra/' + img_2_root + '-' + j + '.jpg"></div>';
            }
            temp_img_html += '</div>';
            
            console.log(temp_img_html);
            $("#extra-images-2").html(temp_img_html);
       
            //we draw the bar chart comparing the shoes
            draw(convertObj(response[0]), convertObj(response[1]));       
            
            $(document).ready(function () {
                //initialize swiper when document ready  
                var mySwiper = new Swiper ('.swiper-container', {
                  // Optional parameters
                  direction: 'horizontal',
                  loop: true
                });        
            });
        }
    });

</script>



</body>
</html>
